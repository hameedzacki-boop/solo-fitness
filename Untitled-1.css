<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solo Leveling - Syst√®me d'Entra√Ænement</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #000000;
            --bg-secondary: #0a0a0a;
            --bg-card: #111111;
            --border: #222222;
            --text-primary: #ffffff;
            --text-secondary: #999999;
            --accent: #ffffff;
            --success: #22c55e;
            --danger: #ef4444;
            --warning: #f59e0b;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Login Screen */
        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 40px;
            max-width: 400px;
            width: 100%;
        }

        .login-title {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 10px;
            text-align: center;
        }

        .login-subtitle {
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.9em;
        }

        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="file"] {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 1em;
            transition: all 0.3s ease;
        }

        input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: var(--accent);
            color: var(--bg-primary);
            border: none;
            border-radius: 6px;
            font-weight: 600;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-primary);
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
        }

        /* Main App */
        .app {
            display: none;
        }

        .app.active {
            display: block;
        }

        header {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            padding: 20px 0;
            margin-bottom: 30px;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5em;
            font-weight: 700;
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid var(--border);
            object-fit: cover;
            cursor: pointer;
        }

        .logout-btn {
            padding: 8px 16px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-primary);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .logout-btn:hover {
            background: var(--bg-secondary);
        }

        .dashboard {
            display: grid;
            grid-template-columns: 300px 1fr 300px;
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 24px;
        }

        .card-title {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .profile-section {
            text-align: center;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 2px solid var(--border);
            margin: 0 auto 20px;
            object-fit: cover;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .profile-avatar:hover {
            border-color: var(--accent);
        }

        .level-badge {
            display: inline-block;
            background: var(--accent);
            color: var(--bg-primary);
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 1.1em;
            margin-bottom: 15px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: var(--text-secondary);
        }

        .stat-value {
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-secondary);
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--accent);
            transition: width 0.5s ease;
        }

        .training-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .training-card:hover {
            border-color: var(--accent);
            transform: translateX(5px);
        }

        .training-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .training-title {
            font-size: 1.1em;
            font-weight: 600;
        }

        .difficulty-badge {
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .difficulty-facile {
            background: rgba(34, 197, 94, 0.2);
            color: var(--success);
        }

        .difficulty-moyen {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .difficulty-difficile {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .training-description {
            color: var(--text-secondary);
            margin-bottom: 15px;
            font-size: 0.95em;
        }

        .training-rewards {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .reward {
            color: var(--text-secondary);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }

        .stat-icon {
            font-size: 1.8em;
            margin-bottom: 8px;
        }

        .stat-name {
            color: var(--text-secondary);
            font-size: 0.85em;
            margin-bottom: 5px;
        }

        .stat-number {
            font-size: 1.8em;
            font-weight: 700;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .camera-container {
            position: relative;
            width: 100%;
            margin: 20px 0;
        }

        video, canvas {
            width: 100%;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        canvas {
            display: none;
        }

        .camera-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .verification-status {
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            text-align: center;
            font-weight: 500;
        }

        .status-pending {
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid var(--warning);
            color: var(--warning);
        }

        .status-success {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .status-failed {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        .countdown {
            text-align: center;
            font-size: 1.2em;
            color: var(--text-secondary);
            margin: 15px 0;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: none;
            max-width: 350px;
        }

        .notification.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
            }
            to {
                transform: translateX(0);
            }
        }

        .timer-display {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 12px;
            text-align: center;
            margin-bottom: 15px;
        }

        .timer-label {
            color: var(--text-secondary);
            font-size: 0.85em;
            margin-bottom: 5px;
        }

        .timer-value {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--warning);
        }

        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- √âcran de connexion -->
    <div class="login-screen" id="loginScreen">
        <div class="login-card">
            <h1 class="login-title">Solo Leveling</h1>
            <p class="login-subtitle">Syst√®me d'Entra√Ænement</p>
            
            <div id="loginForm">
                <div class="input-group">
                    <label class="input-label">Nom d'utilisateur</label>
                    <input type="text" id="username" placeholder="Votre nom">
                </div>
                <div class="input-group">
                    <label class="input-label">Email</label>
                    <input type="email" id="email" placeholder="votre@email.com">
                </div>
                <div class="input-group">
                    <label class="input-label">Photo de profil (optionnel)</label>
                    <input type="file" id="profilePicture" accept="image/*">
                </div>
                <button class="btn" onclick="login()">Commencer l'Entra√Ænement</button>
            </div>
        </div>
    </div>

    <!-- Application principale -->
    <div class="app" id="app">
        <header>
            <div class="header-content">
                <div class="logo">SOLO LEVELING</div>
                <div class="user-menu">
                    <span id="headerUsername"></span>
                    <img src="" alt="Avatar" class="user-avatar" id="headerAvatar" onclick="openProfileModal()">
                    <button class="logout-btn" onclick="logout()">D√©connexion</button>
                </div>
            </div>
        </header>

        <div class="container">
            <div class="dashboard">
                <!-- Profil -->
                <div class="card">
                    <div class="profile-section">
                        <img src="" alt="Avatar" class="profile-avatar" id="profileAvatar" onclick="openProfileModal()">
                        <div class="level-badge">Niveau <span id="playerLevel">1</span></div>
                        <p style="color: var(--text-secondary); margin-bottom: 15px;">Chasseur</p>
                        
                        <div class="progress-bar">
                            <div class="progress-fill" id="xpBar" style="width: 0%"></div>
                        </div>
                        <p style="color: var(--text-secondary); font-size: 0.9em; margin-bottom: 20px;">
                            <span id="currentXP">0</span> / <span id="maxXP">100</span> XP
                        </p>

                        <div style="margin-top: 20px;">
                            <div class="stat-row">
                                <span class="stat-label">Pi√®ces</span>
                                <span class="stat-value" id="coins">1000</span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">PV</span>
                                <span class="stat-value"><span id="currentHP">100</span>/<span id="maxHP">100</span></span>
                            </div>
                            <div class="stat-row">
                                <span class="stat-label">Qu√™tes Compl√©t√©es</span>
                                <span class="stat-value" id="questsCompleted">0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Entra√Ænements -->
                <div class="card">
                    <div class="card-title">Entra√Ænements Quotidiens</div>
                    
                    <div id="cooldownTimer" class="timer-display hidden">
                        <div class="timer-label">Prochaine qu√™te disponible dans</div>
                        <div class="timer-value" id="timerValue">00:00</div>
                    </div>

                    <div id="trainingsList"></div>
                    
                    <button class="btn btn-secondary" onclick="generateTrainings()" id="refreshBtn">
                        Nouveaux Entra√Ænements
                    </button>
                </div>

                <!-- Statistiques -->
                <div class="card">
                    <div class="card-title">Statistiques</div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üí™</div>
                            <div class="stat-name">Force</div>
                            <div class="stat-number" id="strength">10</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">‚ö°</div>
                            <div class="stat-name">Agilit√©</div>
                            <div class="stat-number" id="agility">10</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üß†</div>
                            <div class="stat-name">Intelligence</div>
                            <div class="stat-number" id="intelligence">10</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üõ°Ô∏è</div>
                            <div class="stat-name">Endurance</div>
                            <div class="stat-number" id="endurance">10</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de v√©rification cam√©ra -->
    <div class="modal" id="verificationModal">
        <div class="modal-content">
            <h2 class="modal-title" id="modalTitle">V√©rification de la Qu√™te</h2>
            <p id="modalDescription" style="color: var(--text-secondary); margin-bottom: 20px;"></p>
            
            <div class="camera-container">
                <video id="video" autoplay playsinline></video>
                <canvas id="canvas"></canvas>
            </div>

            <div class="verification-status hidden" id="verificationStatus"></div>

            <div class="camera-controls">
                <button class="btn" onclick="captureAndVerify()" id="captureBtn">
                    Capturer et V√©rifier
                </button>
                <button class="btn btn-secondary" onclick="closeVerificationModal()">
                    Annuler
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de profil -->
    <div class="modal" id="profileModal">
        <div class="modal-content">
            <h2 class="modal-title">Modifier le Profil</h2>
            <div class="input-group">
                <label class="input-label">Changer la photo de profil</label>
                <input type="file" id="newProfilePicture" accept="image/*" onchange="updateProfilePicture()">
            </div>
            <button class="btn btn-secondary" onclick="closeProfileModal()">Fermer</button>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script>
        // Variables globales
        let player = {
            username: '',
            email: '',
            avatar: '',
            level: 1,
            xp: 0,
            maxXP: 100,
            coins: 1000,
            hp: 100,
            maxHP: 100,
            strength: 10,
            agility: 10,
            intelligence: 10,
            endurance: 10,
            questsCompleted: 0,
            lastQuestTime: 0
        };

        let currentTraining = null;
        let stream = null;
        const COOLDOWN_TIME = 60000; // 1 minute en millisecondes

        // Templates d'entra√Ænements
        const trainingTemplates = [
            {
                title: "Pompes de Force",
                description: "Effectue 20 pompes avec une forme correcte",
                difficulty: "facile",
                xpReward: 50,
                coinReward: 100,
                statBonus: { strength: 2, endurance: 1 },
                verification: "pompes"
            },
            {
                title: "Squats d'Endurance",
                description: "R√©alise 30 squats en gardant le dos droit",
                difficulty: "moyen",
                xpReward: 75,
                coinReward: 150,
                statBonus: { endurance: 3, strength: 1 },
                verification: "squats"
            },
            {
                title: "Planche Abdominale",
                description: "Tiens une planche pendant 45 secondes",
                difficulty: "moyen",
                xpReward: 80,
                coinReward: 160,
                statBonus: { endurance: 2, strength: 2 },
                verification: "planche"
            },
            {
                title: "Sprint sur Place",
                description: "Course sur place pendant 30 secondes √† vitesse maximale",
                difficulty: "facile",
                xpReward: 60,
                coinReward: 120,
                statBonus: { agility: 2, endurance: 1 },
                verification: "sprint"
            },
            {
                title: "Burpees Explosifs",
                description: "Effectue 15 burpees complets avec saut",
                difficulty: "difficile",
                xpReward: 150,
                coinReward: 300,
                statBonus: { strength: 3, agility: 2, endurance: 3 },
                verification: "burpees"
            },
            {
                title: "Mountain Climbers",
                description: "R√©alise 40 mountain climbers (20 par jambe)",
                difficulty: "moyen",
                xpReward: 70,
                coinReward: 140,
                statBonus: { agility: 3, endurance: 2 },
                verification: "mountain_climbers"
            },
            {
                title: "M√©ditation",
                description: "M√©dite pendant 5 minutes en position assise",
                difficulty: "facile",
                xpReward: 40,
                coinReward: 80,
                statBonus: { intelligence: 3 },
                verification: "meditation"
            },
            {
                title: "Jumping Jacks",
                description: "Effectue 50 jumping jacks avec coordination",
                difficulty: "facile",
                xpReward: 55,
                coinReward: 110,
                statBonus: { agility: 2, endurance: 1 },
                verification: "jumping_jacks"
            }
        ];

        // Initialisation
        function init() {
            const savedPlayer = getCookie('soloLevelingPlayer');
            if (savedPlayer) {
                player = JSON.parse(savedPlayer);
                showApp();
            }
            updateCooldownTimer();
            setInterval(updateCooldownTimer, 1000);
        }

        // Connexion
        function login() {
            const username = document.getElementById('username').value.trim();
            const email = document.getElementById('email').value.trim();
            const fileInput = document.getElementById('profilePicture');

            if (!username || !email) {
                showNotification('Veuillez remplir tous les champs', 'error');
                return;
            }

            player.username = username;
            player.email = email;

            if (fileInput.files && fileInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    player.avatar = e.target.result;
                    saveAndShowApp();
                };
                reader.readAsDataURL(fileInput.files[0]);
            } else {
                player.avatar = `https://ui-avatars.com/api/?name=${encodeURIComponent(username)}&background=000&color=fff&size=200`;
                saveAndShowApp();
            }
        }

        function saveAndShowApp() {
            setCookie('soloLevelingPlayer', JSON.stringify(player), 365);
            showApp();
            showNotification('Bienvenue, ' + player.username + ' !', 'success');
        }

        function showApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('app').classList.add('active');
            updateUI();
            generateTrainings();
        }

        function logout() {
            if (confirm('√ätes-vous s√ªr de vouloir vous d√©connecter ?')) {
                deleteCookie('soloLevelingPlayer');
                location.reload();
            }
        }

        // Gestion des cookies
        function setCookie(name, value, days) {
            const expires = new Date();
            expires.setTime(expires.getTime() + days * 24 * 60 * 60 * 1000);
            document.cookie = `${name}=${value};expires=${expires.toUTCString()};path=/`;
        }

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }

        function deleteCookie(name) {
            document.cookie = `${name}=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/`;
        }

        // Mise √† jour de l'interface
        function updateUI() {
            document.getElementById('headerUsername').textContent = player.username;
            document.getElementById('headerAvatar').src = player.avatar;
            document.getElementById('profileAvatar').src = player.avatar;
            document.getElementById('playerLevel').textContent = player.level;
            document.getElementById('currentXP').textContent = player.xp;
            document.getElementById('maxXP').textContent = player.maxXP;
            document.getElementById('coins').textContent = player.coins;
            document.getElementById('currentHP').textContent = player.hp;
            document.getElementById('maxHP').textContent = player.maxHP;
            document.getElementById('questsCompleted').textContent = player.questsCompleted;
            document.getElementById('strength').textContent = player.strength;
            document.getElementById('agility').textContent = player.agility;
            document.getElementById('intelligence').textContent = player.intelligence;
            document.getElementById('endurance').textContent = player.endurance;

            const xpPercent = (player.xp / player.maxXP) * 100;
            document.getElementById('xpBar').style.width = xpPercent + '%';
        }

        // G√©n√©rer des entra√Ænements
        function generateTrainings() {
            const trainingsList = document.getElementById('trainingsList');
            trainingsList.innerHTML = '';

            const shuffled = [...trainingTemplates].sort(() => 0.5 - Math.random());
            const selected = shuffled.slice(0, 3);

            selected.forEach((training, index) => {
                const card = document.createElement('div');
                card.className = 'training-card';
                card.innerHTML = `
                    <div class="training-header">
                        <div class="training-title">${training.title}</div>
                        <div class="difficulty-badge difficulty-${training.difficulty}">
                            ${training.difficulty.toUpperCase()}
                        </div>
                    </div>
                    <div class="training-description">${training.description}</div>
                    <div class="training-rewards">
                        <span class="reward">+${training.xpReward} XP</span>
                        <span class="reward">+${training.coinReward} Pi√®ces</span>
                    </div>
                    <button class="btn" onclick="startVerification(${index})" id="trainBtn${index}">
                        Commencer
                    </button>
                `;
                trainingsList.appendChild(card);
            });

            window.currentTrainings = selected;
            checkCooldown();
        }

        // V√©rifier le cooldown
        function checkCooldown() {
            const now = Date.now();
            const timeSinceLastQuest = now - player.lastQuestTime;
            const isOnCooldown = timeSinceLastQuest < COOLDOWN_TIME;

            document.querySelectorAll('[id^="trainBtn"]').forEach(btn => {
                btn.disabled = isOnCooldown;
            });

            document.getElementById('refreshBtn').disabled = isOnCooldown;

            if (isOnCooldown) {
                document.getElementById('cooldownTimer').classList.remove('hidden');
            } else {
                document.getElementById('cooldownTimer').classList.add('hidden');
            }
        }

        function updateCooldownTimer() {
            const now = Date.now();
            const timeSinceLastQuest = now - player.lastQuestTime;
            const timeRemaining = COOLDOWN_TIME - timeSinceLastQuest;

            if (timeRemaining > 0) {
                const seconds = Math.floor((timeRemaining / 1000) % 60);
                const minutes = Math.floor(timeRemaining / 1000 / 60);
                document.getElementById('timerValue').textContent = 
                    `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            } else {
                checkCooldown();
            }
        }

        // D√©marrer la v√©rification
        async function startVerification(index) {
            currentTraining = window.currentTrainings[index];
            document.getElementById('modalTitle').textContent = currentTraining.title;
            document.getElementById('modalDescription').textContent = currentTraining.description;
            document.getElementById('verificationStatus').classList.add('hidden');
            document.getElementById('verificationModal').classList.add('active');

            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'user' },
                    audio: false 
                });
                document.getElementById('video').srcObject = stream;
            } catch (error) {
                showNotification('Impossible d\'acc√©der √† la cam√©ra', 'error');
                closeVerificationModal();
            }
        }

        // Capturer et v√©rifier
        async function captureAndVerify() {
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const status = document.getElementById('verificationStatus');

            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0);

            // Afficher le statut de v√©rification
            status.className = 'verification-status status-pending';
            status.textContent = '‚è≥ Analyse en cours...';
            status.classList.remove('hidden');

            // Simulation de v√©rification IA (dans un vrai cas, envoyer √† Claude API)
            setTimeout(() => {
                const isVerified = analyzeImage();
                
                if (isVerified) {
                    status.className = 'verification-status status-success';
                    status.textContent = '‚úÖ Qu√™te valid√©e ! R√©compenses attribu√©es.';
                    
                    setTimeout(() => {
                        completeTraining();
                        closeVerificationModal();
                    }, 2000);
                } else {
                    status.className = 'verification-status status-failed';
                    status.textContent = '‚ùå V√©rification √©chou√©e. R√©essayez en montrant clairement l\'exercice.';
                }
            }, 2000);
        }

        // Analyse d'image (simulation - dans un cas r√©el, utiliser l'API Claude)
        function analyzeImage() {
            // Simulation : 80% de chance de succ√®s
            return Math.random() > 0.2;
        }

        // Compl√©ter l'entra√Ænement
        function completeTraining() {
            player.xp += currentTraining.xpReward;
            player.coins += currentTraining.coinReward;
            player.questsCompleted++;
            player.lastQuestTime = Date.now();

            for (let stat in currentTraining.statBonus) {
                player[stat] += currentTraining.statBonus[stat];
            }

            checkLevelUp();
            updateUI();
            setCookie('soloLevelingPlayer', JSON.stringify(player), 365);
            
            showNotification(`Qu√™te compl√©t√©e ! +${currentTraining.xpReward} XP, +${currentTraining.coinReward} Pi√®ces`, 'success');
            
            checkCooldown();
        }

        // V√©rifier le level up
        function checkLevelUp() {
            if (player.xp >= player.maxXP) {
                player.xp -= player.maxXP;
                player.level++;
                player.maxXP = Math.floor(player.maxXP * 1.5);
                player.maxHP += 20;
                player.hp = player.maxHP;
                player.strength += 1;
                player.agility += 1;
                player.intelligence += 1;
                player.endurance += 1;

                showNotification(`üéâ LEVEL UP ! Niveau ${player.level} atteint !`, 'success');
            }
        }

        // Fermer le modal de v√©rification
        function closeVerificationModal() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            document.getElementById('verificationModal').classList.remove('active');
        }

        // Ouvrir/fermer le modal de profil
        function openProfileModal() {
            document.getElementById('profileModal').classList.add('active');
        }

        function closeProfileModal() {
            document.getElementById('profileModal').classList.remove('active');
        }

        // Mettre √† jour la photo de profil
        function updateProfilePicture() {
            const fileInput = document.getElementById('newProfilePicture');
            if (fileInput.files && fileInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    player.avatar = e.target.result;
                    updateUI();
                    setCookie('soloLevelingPlayer', JSON.stringify(player), 365);
                    showNotification('Photo de profil mise √† jour !', 'success');
                };
                reader.readAsDataURL(fileInput.files[0]);
            }
        }

        // Afficher une notification
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.borderColor = type === 'success' ? 'var(--success)' : 'var(--danger)';
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Initialiser au chargement
        init();
    </script>
</body>
</html>